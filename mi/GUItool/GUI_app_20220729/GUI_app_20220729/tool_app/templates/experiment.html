<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>東洋紡MIツール</title>
    <!-- css読み込み -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link rel="stylesheet" href="../static/css/btn_add_del.css">
    <link rel="stylesheet" href="../static/css/header_msg.css">
    <link rel="stylesheet" href="../static/css/past_info.css">
    <link rel="stylesheet" href="../static/css/tooltip.css">
    <link rel="stylesheet" href="../static/css/table_disp.css">
    <link rel="stylesheet" href="../static/css/checkbox.css">
    <link rel="stylesheet" href="../static/css/list_item.css">
    <link rel="stylesheet" href="../static/css/default_setting.css">
    <!-- jQuery読み込み -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="../static/js/btn_control.js"></script>
    <script src="../static/js/submit_preview_step1.js"></script>
    <script src="../static/js/pathcopy.js"></script>
    <script src="../static/js/formswitch.js"></script>
    <script src="../static/js/submit_register_step1.js"></script>    
    <script src="../static/js/recover_step1.js"></script>
    <script src="../static/js/submit_visualization_step1.js"></script>
    <script src="../static/js/progressbar_step1.js"></script>
    <script src="../static/js/preview_mfp.js"></script>    
    <script src="../static/js/submit_modeling_step2.js"></script>
    <script src="../static/js/progressbar_step2.js"></script>
    <script src="../static/js/search_chemical.js"></script>        
    <script src="../static/js/submit_condition_step3.js"></script>
    <script src="../static/js/recover_step3.js"></script>
    <script src="../static/js/progressbar_step3.js"></script>
    <script src="../static/js/submit_target_step3.js"></script>
    <script src="../static/js/fileupload.js"></script>
    <!--プログレスバー用-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</head>

<body style="padding-top: 10rem">
<!--Flaskからexp_idの受け取り-->
<script type="text/javascript">
    const exp_id = {{exp_id | tojson}};
    let finished = {{finished | tojson}};
    let pow_check_cols = {{pow_check_cols | tojson}};
    let status_step1 = {{status_step1 | tojson}}
    let status_step2 = {{status_step2 | tojson}}
    let status_step3 = {{status_step3 | tojson}}
    let check_bitnum = {{check_bitnum | tojson}}
</script>

<!--ヘッダー-->
<nav class="nav-fixed">
    <div class="nav-above">
        <table style="width: 100%; height: 100%; border: 0px; border-spacing: 0px; border-collapse: collapse;">
            <tbody>
                <tr>
                    <td class="nav-above-left" >東洋紡MIツール</td>
                    <td class="nav-above-right" style="min-width: 130px;">
                        <a href="{{ url_for('index', user_id=user_id) }}" style="color:white">[実験一覧に戻る]</a>
                    </td>
                    <td class="nav-above-right" style="min-width: 180px;">
                        <a href="{{ url_for('downloadzip', exp_id=exp_id) }}" style="color:white">[実験結果のダウンロード]</a>
                    </td>
                    <td class="nav-above-right" style="min-width: 90px;">
                        <a href="{{ url_for('logout', exp_id=exp_id) }}" style="color:white">[ログアウト]</a>
                    </td>
                    <td style="min-width: 40px;">
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="nav-bellow">
        <table style="width: 100%; height: 100%; border: 0px; border-spacing: 0px; border-collapse: separate;">
            <tbody>
                <tr>
                    <td class="nav-bellow-left" style="font-size: 18px;" rowspan="3">実験名:{{ name }}<br>実験ID:{{ exp_id }}</td>
                    <td class="nav-bellow-right-space"></td>
                    <td style="min-width: 40px;" rowspan="3"></td>
                </tr>
                <tr>
                    <td class="nav-bellow-right">
                        <span style="margin-left:5px;">{{ error_message }}</span>
                        {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            <br>
                            {% for category, message in messages %}
                            <span style="margin-left:5px; color:firebrick">{{ message }}</span>
                            {% endfor %}
                        {% endif %}
                        {% endwith %}
                    </td>
                </tr>
                <tr>
                    <td class="nav-bellow-right-space">
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</nav>

<!-- メインコンテンツ -->
<div id="contents" class="mt-3 mx-5">
<!-- Step1:データ前処理 -->
<div id=data_import class="contents card">
    <div class="card-header">
        <h3>Step1:データ前処理</h3>
    <div class="card-body">
        <ul class="list-group list-group-flush">
            <!-- 入力データの登録 -->
            <li class="list-item">
                <div  style="border-width: 0px 0px 0px 7px; border-color: #BBBBBB; border-style: solid; padding: 15px 10px; margin:0px 0px 10px 0px;">
                    <h4>入力ファイルの管理</h4>
                </div>
                <h5 class="card-title">ファイルアップロード</h5>
                <form method="post" enctype ="multipart/form-data" action="{{ url_for('upload_file', exp_id=exp_id) }}">
                <input type="file" name="file" id="btn_file_select" onchange="checkFileSize('btn_file_select')" required>
                <input type="submit" id="btn_file_upload" value="アップロード">
                </form>

                <h5 class="card-title">S3上のファイル一覧</span></h5>
                <div class="table-responsive text-break">
                    <table class="table table-striped table-hover bulk_table">                                    
                        <thead>
                            <tr>
                                <th style="width: 230px;" scope ="col">ファイル名</th>
                                <th style="width: 180px;" scope ="col">最終更新日</th>
                                <th style="text-align: center; min-width: 160px;" scope ="col"></th>
                                <th style="text-align: center; min-width: 180px;" scope ="col"></th>
                                <th style="text-align: center; min-width: 100px;" scope ="col"></th>
                                <th style="text-align: center; min-width: 60px;" scope ="col"></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for s3_item in s3_file_list %}
                            <tr>
                                <td style="width: 230px;">{{ s3_item }}</td>
                                <td style="width: 180px;">{{ time_array[loop.index0] }}</td>
                                <td style="text-align: center; min-width: 160px;"><a class="pathcopy_link" href="javascript:linkPathCopy('{{ s3_item }}')">[分析対象パスのコピー]</a></td>
                                <td style="text-align: center; min-width: 180px;"><a class="pathcopy_link" href="javascript:linkCasPathCopy('{{ s3_item }}')">[CAS対応表パスのコピー]</a></td>
                                <td style="text-align: center; min-width: 100px;"><a href="{{ url_for('download_file', exp_id=exp_id, filename=s3_item) }}">[ダウンロード]</a></td>
                                <td style="text-align: center; min-width: 60px;"><a href="{{ url_for('delete_file', exp_id=exp_id, filename=s3_item) }}"><font color="red">[削除]</font></a></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </li>

            <li class="list-item">
                <div  style="border-width: 0px 0px 0px 7px;  border-color: #BBBBBB;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                    <h4>データの基本情報</h4>
                </div>
                <!-- 入力データの登録フォーム -->
                <form action="{{ url_for('preview_s3_bucket_data', exp_id=exp_id) }}" method="POST">
                    <h5 class="card-title">分析対象データのs3パス<span class="text-black-50 small">※必須</span></h5>
                    <input type="text" name="s3_input" size=100 placeholder="S3_INPUT_PATH" value="{{ input_s3_filename }}">
                    <h5 class="card-title">Password<span class="text-black-50 small"></span></h5>
                    <input type="password" name="excel_password" size=100 placeholder="None">

                    <h5 class="card-title">分子構造組込の実行</h5>
                    <select id="master_chem" name="chem_type" style="margin-bottom: 5px;" onchange="formSwitch_chemtype('master_chem', 'master_id')">
                        <option value="not" selected>実行しない</option>
                        <option value="mfp">実行する（Morgan Fingerprint）</option>
                        <option value="maccs">実行する（Maccs Key）</option>
                    </select>

                    <div id="master_id" style="display: none;">
                        <h5 class="card-title">CAS対応表のs3パス<span class="text-black-50 small">※必須</span></h5>
                        <input type="text" name="s3_master" size=100 placeholder="S3_MASTER_PATH">    
                        <h5 class="card-title">Password<span class="text-black-50 small"></span></h5>
                        <input type="password" name="master_password" size=100 placeholder="None">    
                    </div>

                    <div class="card-title" style="text-align: left;">
                        <input type="submit" id="btn_submit_preview" value="データのプレビュー">
                    </div>
                </form>
                <h6><span class="text-black-50 mb-1">現在の分析対象のデータ: {{ s3uri_original_data }}</span></h6>
                <h6><span class="text-black-50 mb-1">現在のマスターデータ: {{ s3uri_master_data }}</span></h6>

                <!-- データのプレビュー -->
                <div class="table-responsive text-break">
                    <table class="table table-striped table-hover number_table" style="text-align: right;">
                        <thead>
                            <tr>
                                <th style="text-align: right; min-width: 50px;" scope="col">#</th>
                                {%- for i in df_s3_columns %} 
                                <th style="text-align: right; min-width: 130px;" scope="col">{{ i|e }}</th>
                                {%- endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {%- for i in df_s3_values %}
                            <tr>
                                <th style="text-align: right; min-width: 50px;">{{ loop.index0 }}</th>
                                {% for j in i %}
                                <td style="text-align: right; min-width: 130px;">{{ j|e }}</td>
                                {% endfor %}
                            </tr>
                            {%- endfor %}
                        </tbody>
                    </table>
                </div>

                <div class="input_step1">
                    <!-- 入力変数の登録 -->
                    <div class="input_step1-left">
                        <h5 class="card-title" style="text-decoration: underline;">解析用の入力情報</h5>
                        <form id="read_s3_bucket_data" method="POST">
                            <!--
                            <h5 class="card-title">アウトプット格納先<span class="text-black-50 small">※必須</span></h5>
                            <input type="text" name="s3_output" class="s3_output" size=50 placeholder="sagemaker/yourname/yourtheme">
                            -->
                            <h5 class="card-title">目的変数<span class="text-black-50 small">※必須</span></h5>
                            <input type="text" name="objectives" class="objectives" size=50 placeholder="colA,colB,colC">
                            <h5 class="card-title">不要列</h5>
                            <input type="text" name="drop_cols" class="drop_cols" size=50 placeholder="colA,colB,colC">
                            <div class="card-title" align="left">
                                <input type="submit" id="btn_submit_register" value="登録">
                            </div>
                        </form>        
                    </div>
                    <!-- 登録済み情報の表示 -->
                    <div class="input_step1-right" style="margin-top: 5px;">
                        <h5 class="card-title" style="text-decoration: underline;"><div class="mb-1" style="margin-left: 5px; color: #555555;">登録済みの入力情報</div></h5>
                        <!--<h5 class="card-title"><div class="mb-1" style="margin: 0px 0px 5px 10px; color: #555555;">アウトプット格納先</div></h5>
                        <h6 class="card-title"><div class="mb-1" style="margin: 10px 0px 5px 10px; color: #555555;">{{ s3_bucket_path }}</div></h6>-->
                        <h5 class="card-title"><div class="mb-1" style="margin: 15px 0px 5px 10px; color: #555555;">目的変数</div></h5>
                        <h6 class="card-title"><div class="mb-1" style="margin: 10px 0px 5px 10px; color: #555555;">{{ objectives_message }}</div></h6>
                        <h5 class="card-title"><div class="mb-1" style="margin: 15px 0px 5px 10px; color: #555555;">不要列</div></h5>
                        <h6 class="card-title"><div class="mb-1" style="margin: 10px 0px 5px 10px; color: #555555">{{ drop_cols }}</div></h6>
                    </div>
                </div>
                <h5 id="register_block" style="text-align: center;"> </h5>
            </li>

            <li class="list-item">
                <div  style="border-width: 0px 0px 0px 7px;  border-color: #BBBBBB;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                    <h4>データの可視化（利用する変数は最大20個）</h4>
                </div>
                <form id="visualization" method="POST" style="margin-bottom: -10px;">
                    <div class="div_methods" style="margin-bottom: 5px;">
                        可視化手法:
                        <label><input type="checkbox" class="vis_method" value="pairplot" style="margin: 0px 5px 5px 10px;" checked>散布図行列</label>
                        <label><input type="checkbox" class="vis_method" value="correlation_matrix" style="margin: 0px 5px 5px 10px;" checked>相関行列</label>
                        <label><input type="checkbox" class="vis_method" value="profiles" style="margin: 0px 5px 5px 10px;" checked>Pandas-Profiling(各種統計量)</label>
                    </div>
                    <div style="margin-bottom: 5px;">利用する変数（マーカー付きは目的変数）:</div>
                    <div class="div_visualization cb_cols">
                        {% for col in df_train_columns %}
                            <label><input type="checkbox" name="vis_cb[]" value="{{ col }}" class="visualization_cb"> {{ col }}</label>
                        {% endfor %}
                        {% for col in objectives %}
                            <label><input type="checkbox" name="vis_cb[]" value="{{ col }}" class="visualization_cb"> <span class="marker_line80">{{ col }}</span></label>
                        {% endfor %}
                    </div>    
                </form>
                <div class="card-title" align="left">
                    <input type="submit"  style="margin-top: 5px;" id="btn_submit_visualization" value="実行">
                </div>

                <div class="input_step1_latest">
                    <h6 class="card-title" style="margin-left: 10px;">
                        <div class="mb-1" style="text-decoration: underline; color: #555555;">登録済みの可視化手法</div>
                        <div class="mb-1" style="color: #555555;">{{ vis_method_message }}</div>
                        <br>
                        <div class="mb-1" style="text-decoration: underline; color: #555555;">登録済みの可視化に用いた変数</div>
                        <div class="mb-1" style="color: #555555;">{{ vis_cols }}</div>
                    </h6>

                    <input type="button" id="btn_step1_recover" value="登録済みの変数を反映">
                </div>
            </li>
            
            <!--progressbar表示-->
            <li class="list-item">
                <div class="progressbar_step1">
                    <div class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                        <span class="progress-bar-label mx-2">0%</span>
                    </div>
                </div>
                <br>
                <div id = "status_step1" align="center"></div>
            </li>

            <!-- データ可視化 -->
            <li class="list-item">
                <div  style="border-width: 0px 0px 0px 7px;  border-color: #025c9b;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                    <h4>データの可視化結果</h4>
                </div>
                <div class="container">
                    <div class="row align-items-start">
                        {% if "pairplot" in vis_method %}
                        <div class="col text-center">
                            <h5>Scatter_Matrix</h5>
                            <a href="{{ scatter_path }}" target="_blank" rel="noopener"><img src="{{ scatter_path }}" onerror="this.style.display='none'" width="400" height="400" class="img-fluid"></a>
                        </div>
                        {% endif %}
                        {% if "correlation_matrix" in vis_method %}
                        <div class="col text-center">
                            <h5>Correlation_Matrix</h5>
                            <a href="{{ correlation_path }}" target="_blank" rel="noopener"><img src="{{ correlation_path }}" onerror="this.style.display='none'" width="400" height="400" class="img-fluid"></a>                                                    
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% if "profiles" in vis_method %}
                    <div  style="border-width: 0px 0px 0px 7px;  border-color: greenyellow;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                        <h5> Pandas-Profiling </h5>
                    </div>
                    <h5><a href="{{ profile_path }}" target="_blank" rel="noopener">Link: Pandas-Profiling</a></h5>
                {% endif %}
            </li>

            <!--mfpの追加情報入力、可視化-->
            {% if chem_type == 'mfp' %}
            <li class="list-item">
                <div class="mfp_step1">
                    <div  style="border-width: 0px 0px 0px 7px;  border-color: #BBBBBB;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                        <h4>Morgan Fingerprintの追加入力情報</h4>
                    </div>
                    <form id="read_chemical_data", exp_id=exp_id) }}" method="POST">
                        <h5 class="card-title">半径</h5>
                        <input type="text" name="radius" class="radius" size=10 style="text-align: right;" placeholder="int">
                        {% if check_bitnum == "short" %}
                            <h5 class="card-title">bit数</h5>
                            <input type="text" name="bit_num" class="bit_num" size=10 style="text-align: right;" value="4096">
                        {% endif %}
                        <div class="card-title" align="left">
                            <input type="submit" id="btn_submit_mfp" value="描画">
                        </div>
                    </form>        
                </div>
                <h5 id="mfp_block" style="text-align: center;"> </h5>
                <div  style="border-width: 0px 0px 0px 7px;  border-color: #025c9b;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                    <h4>Morgan Fingerprintで生成された分子構造一覧</h4>
                </div>
                <div class="table-responsive text-break">
                    <table class="table table-striped table-hover bulk_table">                                    
                        <thead>
                            <tr>
                                <th style="min-width: 190px;" scope="col">原材料名</th>
                                <th style="min-width: 350px;" scope="col">IUPAC物質名</th>
                                <th style="min-width: 150px;" scope="col">CAS番号</th>
                                <th style="text-align: right; width: min-170px;" scope="col">含まれる分子構造数</th>
                                <th style="min-width: 170px;" scope="col">リンク</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for p_link in p_list_structure_links %}
                            <tr>
                                <th style="min-width: 190px;" scope="row"> {{ p_source_names[loop.index0] }} </th>
                                <td style="min-width: 350px;">{{ true_name_list[loop.index0] }}</td>
                                <td style="min-width: 150px;">{{ p_cas_numbers[loop.index0] }}</td>
                                <td style="text-align: right; min-width: 170px;">{{ p_source_nums[loop.index0] }}</td>
                                <td style="min-width: 170px;"> <a href="{{ p_link }}" target="_blank" rel="noopener">{{ p_source_names[loop.index0] }}.png</a> </td>
                            </tr>
                            {%- endfor %}
                        </tbody>
                    </table>
                </div>
            </li>
            {% endif %}
        </ul>    
    </div> 
    </div>
</div>

<!-- Step2:回帰モデル構築 -->
<div id=data_visualization class="contents card">
    <div class="card-header">
        <h3>Step2:モデル構築と評価</h3>
    </div>
    <div class="card-body">
        <ul class="list-group list-group-flush">
            <!-- モデル構築 -->
            <li class="list-item">
                <div  style="border-width: 0px 0px 0px 7px;  border-color: #BBBBBB;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                    <h4>モデルの指定</h4>
                </div>
                <h6>
                <form action="{{ url_for('create_model', exp_id=exp_id) }}" method="POST">
                    <input type="radio" name="ptype" value="Regression" checked style="margin: 0px 5px 0px 10px;">Regression
                    <input type="radio" name="ptype" value="BinaryClassification" style="margin: 0px 5px 0px 10px;">BinaryClassification
                    <input type="radio" name="ptype" value="MulticlassClassification" style="margin: 0px 5px 0px 10px;">MulticlassClassification
                    <div class="card-title" align="left">
                        <input type="submit" value="モデル構築" id="model_building_button" style="margin: 5px 10px 0px 10px;">                                    
                    </div>
                </form>
                </h6>          
                <div class="input_step2_latest">
                    <h6 class="card-title" style="margin-left: 10px;">
                        <span class="mb-1" style="text-decoration: underline; color: #555555;">作成済のモデル種別:</span>
                        <span class="mb-1" style="color: #555555;">{{problemtype}}</span>
                    </h6>
                </div>
            </li>
            
            <!--progressbar表示-->
            <li class="list-item">
                <div class="progressbar_step2">
                    <div class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                        <span class="progress-bar-label mx-2">0%</span>
                    </div>
                </div>
                <br>
                <div id="status_step2" align="center"></div>
            </li>

            <!--モデルの詳細情報表示-->
            <li class="list-item">
                <div  style="border-width: 0px 0px 0px 7px;  border-color: #025c9b;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                    <h4>モデルの詳細情報</h4>
                </div>
                <div class="table-responsive text-break">
                    <table class="table table-striped table-hover bulk_table text-center" >
                        <thead>
                            <tr>
                                <th style="min-width: 150px;" scope="col">目的変数</th>
                                <th style="min-width: 450px;" scope="col">モデル名</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for cnt in range( objectives | length ) %}
                            <tr>
                                <td style="min-width: 150px;">{{ objectives[cnt] }}</td>
                                <td style="min-width: 450px;">{{ model_list[cnt] }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </li>

            <!--テストデータでの評価値-->
            <li class="list-item">     
                <div  style="border-width: 0px 0px 0px 7px;  border-color: #025c9b;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                    <h4>テストデータでの評価値</h4>
                </div>
                <div class="table-responsive text-break">
                    <table class="table table-striped bulk_table text-break">
                        <thead>
                            <tr>
                                <th style="text-align: center; min-width: 150px;" scope ="col">目的変数</th>
                                {% for header_eval in header_eval_list %}
                                <th style="text-align: right; min-width: 100px;" scope ="col">{{ header_eval }}</th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for obj in objectives %} 
                            <tr class="exp_index">
                                <th style="text-align: center; min-width: 150px;">{{ obj }}</th>
                                <td style="text-align: right; min-width: 100px;">{{ eval_list[0][loop.index0] }}</td>
                                <td style="text-align: right; min-width: 100px;">{{ eval_list[1][loop.index0] }}</td>
                                <td style="text-align: right; min-width: 100px;">{{ eval_list[2][loop.index0] }}</td>
                                <td style="text-align: right; min-width: 100px;">{{ eval_list[3][loop.index0] }}</td>
                            </tr>
                            {% endfor %}                                
                        </tbody>
                    </table>
                </div>

                <!--Regression用-->
                <div  style="border-width: 0px 0px 0px 7px;  border-color: #025c9b;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                    {% if problemtype == 'Regression' %}
                        <h4>実値と予測値の比較</h4>
                    {% elif problemtype == "BinaryClassification" or problemtype == "MulticlassClassification" %}
                        <h4>コンフュージョン行列</h4>
                    {% endif %}
                </div>
                <div class="container">
                    <div class="row align-items-start align-middle text-center">
                        {% for objective in objectives %}
                        <div class="col align-middle text-center">
                            <h5>{{ objective }}</h5>
                            <a href="{{ eval_image_list[loop.index0] }}" target="_blank" rel="noopener"><img onerror="this.style.display='none'" src="{{ eval_image_list[loop.index0] }}" width="400" height="400"/></a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </li>
            
            <!--線形モデルの係数-->
            {% if problemtype == 'Regression' %}
            <li class="list-item">
                <div  style="border-width: 0px 0px 0px 7px;  border-color: #025c9b;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                    <h4>線形モデルの係数</h4>
                </div>
                <div class="container">
                    <div class="row align-items-start">
                        {% for cnt in range( objectives | length ) %}
                        <div class="col align-middle text-center">
                            <h5>線形モデルにおける係数(抜粋)</h5>
                            <a href="{{ coef_limit_path_list[cnt] }}" target="_blank" rel="noopener"><img onerror="this.style.display='none'" src="{{ coef_limit_path_list[cnt] }}" width="400" style="margin-left:-100px"></a>
                            <h5><a href="{{ coef_all_path_list[cnt] }}" target="_blank" rel="noopener">線形モデルにおける係数（全体）へのリンク</a></h5>
                        </div>
                        {% endfor %}
                    </div> 
                </div>
            </li> 
            {% endif %}

            <!--shap値-->
            <li class="list-item">
                <div  style="border-width: 0px 0px 0px 7px;  border-color: #025c9b;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                    <h4>Shap値</h4>
                </div>
                <div>
                    <h5><a href="{{ shapreport_path }}" target="_blank" rel="noopener">Shap-Reportへのリンク</a></h5>
                </div>
            </li>

            {% if chem_type == 'mfp' or chem_type == 'maccs' %}
            <li class="list-item">
                <!-- 分子構造の表示 -->
                <div  style="border-width: 0px 0px 0px 7px;  border-color: #BBBBBB;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                    <h4>Shap値上位の分子構造</h4>
                </div>
                <form id="draw_top_data" method="POST">
                    <h5 class="card-title">
                        上位 <input type="text" name="top_num" class="top_num" size=5 style="text-align: right;" placeholder="int"> 位まで <input type="submit" id="btn_submit_top" value="表示">
                    </h5>
                </form>
                <h5 id="top_block" style="text-align: center;"> </h5>
                <div  style="border-width: 0px 0px 0px 7px;  border-color: #025c9b;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                    <h4>検索結果</h4>
                    <h6>※ 5つ以上物質名が対応する場合、マウスオーバーで全て表示</h6>
                </div>
                <div class="container">
                    {% for target in objectives %}
                    <div  style="border-width: 0px 0px 0px 7px;  border-color: greenyellow;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                        <h5> 目的変数：{{ target }} </h5>
                    </div>
                    <div class="row align-items-start align-middle text-center">
                        {% set top_bit_structure_links = top_bit_structure_links_list[loop.index0] %}
                        {% set top_bit_structure_names = top_bit_structure_names_list[loop.index0] %}
                        {% set top_bit_display_names = top_bit_display_names_list[loop.index0] %}
                        {% for top_bit_link in top_bit_structure_links %}
                            <div class="col align-middle text-center">
                                <span style="font-size:16px; font-weight:bold;" class="c-tooltip" data-tooltip="{{ top_bit_structure_names[loop.index0] }}">
                                    <h5> {{ loop.index }}位 </h5>
                                    <a href="{{ top_bit_link }}" target="_blank" rel="noopener"><img src="{{ top_bit_link }}" width="200" height="200"/></a>
                                    <h6 class="card-title" style="font-weight:bold">{{ top_bit_display_names[loop.index0] }}</h6>
                                </span>
                            </div>
                        {% endfor %}
                    </div>
                    {% endfor %}
                </div>
                <!-- 分子構造の検索 -->
                <div  style="border-width: 0px 0px 0px 7px;  border-color: #BBBBBB;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                    <h4>物質名から分子構造を検索</h4>
                </div>
                <form id="search_chemical_name" method="POST">
                    <h5 class="card-title">物質名を入力</h5>
                    <input type="text" name="source_names" class="source_names" size=50 placeholder="colA,colB,colC">
                    <div class="card-title" align="left">
                        <input type="submit" id="btn_submit_draw" value="検索">
                    </div>
                </form>
                <h5 id="draw_block" style="text-align: center;"> </h5>
                <div  style="border-width: 0px 0px 0px 7px;  border-color: #025c9b;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                    <h4>検索結果</h4>
                </div>
                <div class="table-responsive text-break">
                    <table class="table table-striped table-hover bulk_table">
                        <thead>
                            <tr>
                                <th rowspan="2", style="vertical-align: middle; min-width: 190px;" scope="col">原材料名</th>
                                <th rowspan="2", style="text-align: right; min-width: 170px; vertical-align: middle;" scope="col">bit番号</th>
                                <th style="text-align: center; border-bottom-color: rgba(255, 255, 255, 1);" colspan="{{ objectives | length }}">shap値の順位</th>
                                <th rowspan="2" style="vertical-align: middle; min-width: 170px;" scope="col">リンク</th>
                            </tr>
                            <tr>
                                {% for target in range(objectives | length ) %}
                                <th style="text-align: right; min-width: 160px; border-color: #dee2e6;" scope="col">{{ objectives[target] }}</th>
                                {% endfor %}
                            </tr>        
                        </thead>
                        {% for source_name in source_names %}
                        <tbody>
                            <th rowspan="{{ bit_dict[source_name] | length+1 }}" style="width: 190px; border-bottom-color: #212529;"> {{source_name}} </th>
                            {% for cnt in range( bit_dict[source_name] | length ) %}
                            <tr>
                                <td style="text-align: right; min-width: 170px;"> {{ bit_dict[source_name][cnt] }} </td>
                                {% for target in objectives %}
                                <td style="text-align: right; min-width: 160px;"> {{ objective_dict[source_name][target][cnt] }} </td>
                                {% endfor %}
                                <td style="min-width: 170px;"> <a href="{{ rank_link_dict[source_name][cnt] }}" target="_blank" rel="noopener">{{ source_name}}_{{ bit_dict[source_name][cnt] }}.png</a> </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        {% endfor %}
                    </table>
                </div>

            </li>
            {% endif %}
        </ul>
    </div>
</div>


<!-- Step3:パラメータ探索 -->
<div id="search" class="contents card">
    <div class="card-header">
        <h3>Step3:パラメーター探索</h3>
    </div>
    <div class="card-body">
        <ul class="list-group list-group-flush">
            <!--制約条件の設定-->
            <li class="list-item">                                   
                <div style="border-width: 0px 0px 0px 7px;  border-color: #BBBBBB;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                    <h4>制約条件の設定</h4>
                </div>
                <!--制約条件のform-->
                <form id="sampling" action="{{ url_for('create_sample', exp_id=exp_id) }}" method="POST">
                    <!-- サンプリング回数を設定 -->
                    <div style="margin-bottom: 20px;">
                        <h5 class="card-title"><u>サンプリング回数を設定（上限値:10万）</u></h5>
                        サンプリング回数: <input type="text" name="sampling_num" form="sampling" size=10 style="text-align: right;" value="1000">    
                    </div>
                    
                    <!-- 組成候補の選択方法を設定 -->
                    <div style="margin-bottom: 20px;">
                        <h5 class="card-title"><u>組成候補の選択方法を設定</u></h5>
                        <div class="cb_cols div_combination">
                            <div>パラメータ組み合わせ:</div>
                            {% for col in df_train_columns %}
                                <label><input type="checkbox" name="combination_cb[]" value="{{ col }}" class="combination_cb" form="sampling" style="margin: 0px 5px 5px 10px;">{{ col }}</label>
                            {% endfor %}
                            <div>
                                下限値:<input type="text" name="combination_lower[]" class="combination_lower" form="sampling" size=10 placeholder="" style="text-align: right; margin: 10px 10px 5px 10px;">
                                上限値:<input type="text" name="combination_upper[]" class="combination_upper" form="sampling" size=10 placeholder="" style="text-align: right; margin: 10px 10px 5px 10px;">
                            </div>
                        </div>
                        <button type="button" id="btn_clone_combination" class="btn-add" style="margin: 0px 10px 0px 0px;">設定追加</button></a>
                        <button type="button" id="btn_remove_combination" class="btn-del">設定削除</button></a>                                                                                    
                    </div>


                    <!-- 変数範囲の指定 -->
                    <div style="margin-bottom: 20px;">
                        <h5 class="card-title"><u>変数の値範囲を設定</u></h5>
                        <h6 class="card-title"><u>個別設定</u></h6>
                        <div class="div_range">
                            パラメータ: 
                            <select name="range_sel[]" class="range_sel" form="sampling" style="margin: 0px 15px 5px 15px;">
                                <option value="">パラメータ名を選択</option>
                                {% for col in df_train_columns %}
                                    <option value="{{ col }}">{{ col }}</option>
                                {% endfor %}
                            </select>
                            下限値:<input type="text" name="range_lower[]" class="range_lower" form="sampling" size=10 placeholder="" style="text-align: right; margin: 0px 10px 5px 10px;">
                            上限値:<input type="text" name="range_upper[]" class="range_upper" form="sampling" size=10 placeholder="" style="text-align: right; margin: 0px 10px 5px 10px;">
                        </div>                        
                        <button type="button" id="btn_clone_range" class="btn-add" style="margin: 0px 10px 0px 0px;">設定追加</button>
                        <button type="button" id="btn_remove_range" class="btn-del">設定削除</button>

                        <h6 class="card-title"><u>一括設定</u></h6>
                        係数値: <input type="text" name="sampling_width" form="sampling" size=10 style="text-align: right;" value="1">
                        <input id="nega_flag" type="checkbox" form="sampling" style="margin: 0px 5px 0px 10px;">負の値をサンプリングする
                    </div>

                    <!-- 変数の固定 -->
                    <div style="margin-bottom: 20px;">
                        <h5 class="card-title"><u>変数の固定値を設定</u></h5>
                        <div class="div_fixed">
                            パラメータ:
                            <select name="fixed_sel[]" class="fixed_sel" form="sampling" style="margin: 0px 15px 5px 15px;">
                                <option value="">パラメータ名を選択</option>
                                {% for col in df_train_columns %}
                                    <option value="{{ col }}">{{ col }}</option>
                                {% endfor %}
                            </select>
                            固定値:<input type="text" name="fixed_value[]" class="fixed_val" form="sampling" size=10 placeholder="" style="text-align: right; margin: 0px 10px 5px 10px;">
                        </div>
                        <button type="button" id="btn_clone_fixed" class="btn-add" style="margin: 0px 10px 0px 0px;">設定追加</button>
                        <button type="button" id="btn_remove_fixed" class="btn-del">設定削除</button>                                                                                                                
                    </div>

                    <!--組成時の材料比を設定-->
                    <div style="margin-bottom: 20px;">
                        <h5 class="card-title"><u>組成時の材料比を設定</u></h5>
                        <div class="div_ratio">
                            パラメータ組み合わせ: パラメータ1:
                            <select name = "ratio1_sel[]" class="ratio1_sel" form="sampling" style="margin: 0px 15px 5px 15px;">
                                <option value="">パラメータ名を選択</option>
                                {% for col in df_train_columns %}
                                    <option value="{{ col }}">{{ col }}</option>
                                {% endfor %}
                            </select>
                            パラメータ2:
                            <select name = "ratio2_sel[]" class="ratio2_sel" form="sampling" style="margin: 0px 15px 5px 15px;">
                                <option value="">パラメータ名を選択</option>
                                {% for col in df_train_columns %}
                                    <option value="{{ col }}">{{ col }}</option>
                                {% endfor %}
                            </select>

                            組成比:
                            <input type="text" name="ratio1_value[]" class="ratio1_val" form="sampling" size=10 placeholder="" style="text-align: right; margin: 0px 10px 5px 10px;">:
                            <input type="text" name="ratio2_value[]" class="ratio2_val" form="sampling" size=10 placeholder="" style="text-align: right; margin: 0px 0px 5px 5px;">
                        </div>
                        <button type="button" id="btn_clone_ratio" class="btn-add" style="margin: 0px 10px 0px 0px;">設定追加</button></a>
                        <button type="button" id="btn_remove_ratio" class="btn-del">設定削除</button></a>                                    
                    </div>

                    <!-- 変数間の合計値を設定 -->
                    <div style="margin-bottom: 20px;">
                        <h5 class="card-title"><u>変数間の合計値を設定</u></h5>
                        <div class="cb_cols div_total">
                            <div>パラメータ組み合わせ:</div>
                            {% for col in df_train_columns %}
                                <label><input type="checkbox" name="total_cb[]" value="{{ col }}" class="total_cb" form="sampling" style="margin: 0px 5px 5px 10px;">{{ col }}</label>
                            {% endfor %}
                            <div>
                                合計値:<input type="text" name="total_value[]" class="total_val" form="sampling" size=10 placeholder="" style="text-align: right; margin: 10px 10px 5px 10px;">
                            </div>
                        </div>
                        <button type="button" id="btn_clone_total" class="btn-add" style="margin: 0px 10px 0px 0px;">設定追加</button></a>
                        <button type="button" id="btn_remove_total" class="btn-del">設定削除</button></a>                                            
                    </div>
                    
                    <!-- 変数のグループ和を設定 -->
                    <div style="margin-bottom: 20px;">
                        <h5 class="card-title"><u>変数のグループ和を設定</u></h5>
                        
                        <div class="div_groupsum" id="id_groupsum_0" style="margin-bottom: 10px;">
                            <h6><u>グループ和設定1:</u></h6>
                            <div class="cb_cols div_group" style="margin-left: 20px;">
                                <div>グループ:</div>
                                {% for col in df_train_columns %}
                                    <label><input type="checkbox" name="group_cb[]" value="{{ col }}" class="group_cb" form="sampling" style="margin: 0px 5px 5px 10px;">{{ col }}</label>
                                {% endfor %}
                                <div>
                                    選択数下限値:<input type="text" name="group_value_lower[]" class="group_val_lower" form="sampling" size=10 placeholder="" style="text-align: right; margin: 10px 10px 5px 10px;">
                                    選択数上限値:<input type="text" name="group_value_upper[]" class="group_val_upper" form="sampling" size=10 placeholder="" style="text-align: right; margin: 10px 10px 5px 10px;">
                                </div>
                            </div>

                            <button type="button" class="btn-add_in btn_clone_group" style="margin: 0px 10px 0px 10px;">グループ追加</button></a>
                            <button type="button" class="btn-del btn_remove_group">グループ削除</button></a>

                            <div>
                                合計値:<input type="text" name="group_total[]" class="group_total" form="sampling" size=10 placeholder="" style="text-align: right; margin: 10px 10px 5px 10px;">
                            </div>
                        </div>

                        {% for id_i in range(1, 5) %}
                            <div class="div_groupsum" id="id_groupsum_{{ id_i }}" style="display: none; margin-bottom: 10px;">
                                <h6><u>グループ和設定{{ id_i + 1 }}:</u></h6>
                                <div class="cb_cols div_group" style="margin-left: 20px;">
                                    <div>グループ:</div>
                                    {% for col in df_train_columns %}
                                        <label><input type="checkbox" name="group_cb[]" value="{{ col }}" class="group_cb" form="sampling" style="margin: 0px 5px 5px 10px;">{{ col }}</label>
                                    {% endfor %}
                                    <div>
                                        選択数下限値:<input type="text" name="group_value_lower[]" class="group_val_lower" form="sampling" size=10 placeholder="" style="text-align: right; margin: 10px 10px 5px 10px;">
                                        選択数上限値:<input type="text" name="group_value_upper[]" class="group_val_upper" form="sampling" size=10 placeholder="" style="text-align: right; margin: 10px 10px 5px 10px;">
                                    </div>
                                </div>

                                <button type="button" class="btn-add_in btn_clone_group" style="margin: 0px 10px 0px 10px;">グループ追加</button></a>
                                <button type="button" class="btn-del btn_remove_group">グループ削除</button></a>

                                <div>
                                    合計値:<input type="text" name="group_total[]" class="group_total" form="sampling" size=10 placeholder="" style="text-align: right; margin: 10px 10px 5px 10px;">
                                </div>
                            </div>
                        {% endfor %}

                        <button type="button" id="btn_clone_groupsum" class="btn-add" style="margin: 0px 10px 0px 0px;">設定追加</button></a>
                        <button type="button" id="btn_remove_groupsum" class="btn-del">設定削除</button></a>
                    </div>
                    <!--制約条件確定-->
                    <div class="mt-3" style="margin-bottom: 10px;">
                        <input type="submit" id="btn_submit_condition" value="制約条件確定" form="sampling">
                    </div>
                </form>

                <!--前回の制約条件を表示-->
                <div class="input_step3_latest">
                    <h5 class="card-title" style="text-decoration: underline;"><div class="mb-1" style="margin-left: 5px; color: #555555;">登録済みの制約条件</div></h5>
                    <h6 class="card-title"><div class="mb-1" style="margin: 15px 0px 5px 0px; color: #555555;">組成候補の選択方法</div></h6>
                    <h6 class="card-title"><div class="mb-1" style="margin: 10px 0px 5px 0px; color: #555555;">{{ combination_message }}</div></h6>
                    <h6 class="card-title"><div class="mb-1" style="margin: 0px 0px 5px 0px; color: #555555;">変数の値範囲</div></h6>
                    <h6 class="card-title"><div class="mb-1" style="margin: 10px 0px 5px 0px; color: #555555;">{{ range_message }}</div></h6>
                    <h6 class="card-title"><div class="mb-1" style="margin: 15px 0px 5px 0px; color: #555555;">変数の固定値</div></h6>
                    <h6 class="card-title"><div class="mb-1" style="margin: 10px 0px 5px 0px; color: #555555;">{{ fixed_message }}</div></h6>
                    <h6 class="card-title"><div class="mb-1" style="margin: 15px 0px 5px 0px; color: #555555;">組成時の材料比</div></h6>
                    <h6 class="card-title"><div class="mb-1" style="margin: 10px 0px 5px 0px; color: #555555;">{{ ratio_message }}</div></h6>
                    <h6 class="card-title"><div class="mb-1" style="margin: 15px 0px 5px 0px; color: #555555;">変数の合計値</div></h6>
                    <h6 class="card-title"><div class="mb-1" style="margin: 10px 0px 5px 0px; color: #555555;">{{ total_message }}</div></h6>
                    <h6 class="card-title"><div class="mb-1" style="margin: 15px 0px 5px 0px; color: #555555;">変数のグループ和</div></h6>
                    <h6 class="card-title"><div class="mb-1" style="margin: 10px 0px 10px 0px; color: #555555;">{{ groupsum_message }}</div></h6>
                    <input type="button" id="btn_step3_recover" value="登録済みの制約条件を反映">
                </div>
            </li>
            
            <!--progressbar表示-->
            <li class="list-item">
                <div class="progressbar_step3">
                    <div class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                        <span class="progress-bar-label mx-2">0%</span>
                    </div>
                </div>
                <br>
                <div id="status_step3" style="text-align: center;"></div>
            </li>

            <!--探索実行-->
            <li class="list-item">
                <!--探索手法を設定-->
                <div style="border-width: 0px 0px 0px 7px;  border-color: #BBBBBB;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                    <h4>探索手法と目的変数の設定</h4>
                </div>
                <form id="search_params" action="{{ url_for('search_params', exp_id=exp_id) }}" method="POST">

                    <h5 class="card-title"><u>探索手法を設定</u></h5>
                    <div>
                        <label><input type="checkbox" class="search_method" value="Simulate" style="margin: 0px 5px 0px 10px;">Simulate</label>
                        <label><input type="checkbox" class="search_method" value="Search_Cluster" style="margin: 0px 5px 0px 10px;" id="cluster_check" onchange="formSwitch_cluster('cluster_check', 'cluster_id')">Search_Cluster</label>
                        <label><input type="checkbox" class="search_method" value="Search_Pareto" style="margin: 0px 5px 0px 10px;">Search_Pareto</label>
                    </div>
                    <div id="cluster_id" style="display: none;">
                        クラスター数: <input type="text" name="cluster_num" form="search_params" size=5 value="3" style="text-align: right; margin: 0px 10px 5px 10px;">
                    </div>

                    <!--目的変数の目標値を設定-->
                    <h5 class="card-title"><u>目的変数の目標値を設定</u></h5>
                    <div class="div_target">
                        目的変数:
                        <select name="target_sel[]" form="search_params" style="margin: 0px 15px 5px 15px;">
                            <option value="">目的変数を選択</option>
                            {% for objective in objectives %}
                                <option value="{{ objective }}">{{ objective }}</option>
                            {% endfor %}
                        </select>

                        下限値:<input type="text" name="target_lower[]" form="search_params" size=10 placeholder="" style="text-align: right; margin: 0px 10px 5px 10px;">
                        上限値:<input type="text" name="target_upper[]" form="search_params" size=10 placeholder="" style="text-align: right; margin: 0px 10px 5px 10px;">
                    </div>
                
                    <button type="button" id="btn_clone_target" class="btn-add" style="margin: 0px 10px 0px 0px;">設定追加</button></a>
                    <button type="button" id="btn_remove_target" class="btn-del">設定削除</button></a>

                    <!--刻み値を設定-->
                    <h5 class="card-title"><u>探索結果に対して刻み値を設定</u></h5>
                    <div class="div_step">
                        変数名:
                        <select name="step_sel[]" form="search_params" style="margin: 0px 15px 5px 15px;">
                            <option value="">変数名を選択</option>
                            {% for cols in df_train_columns+objectives %}
                                <option value="{{ cols }}">{{ cols }}</option>
                            {% endfor %}
                        </select>

                        刻み値:<input type="text" name="step_val[]" form="search_params" size=10 placeholder="" style="text-align: right; margin: 0px 10px 5px 10px;">
                    </div>
                
                    <button type="button" id="btn_clone_step" class="btn-add" style="margin: 0px 10px 0px 0px;">設定追加</button></a>
                    <button type="button" id="btn_remove_step" class="btn-del">設定削除</button></a>                    
                    
                    <!--探索実行-->
                    <div class="mt-3">
                        <h5><input type="submit" id=btn_submit_target value="探索実行" form="search_params"></h5>
                    </div>                    
                </form>
                <h5 id="search_block" style="text-align: center;"> </h5>
                <!--前回の制約条件を表示-->
                <div class="input_step3_search">
                    <h6><div class="mb-1" style="color: #555555;">現在の目的変数</div></h6>
                    <h6><span class="mb-1" style="color: #555555;">{{ target_message }}</span></h6>    
                </div>
            </li>

            <!--探索結果を表示-->
            <li class="list-item">
                <!--探索手法を設定-->
                <div style="border-width: 0px 0px 0px 7px;  border-color: #025c9b;  border-style: solid;  padding: 15px 10px;   margin:0px 0px 10px 0px;">
                    <h4>探索結果</h4>
                </div>
                <!--Simulate用テンプレート-->
                {% if 'Simulate' in search_method %}
                <li class="list-item">
                    <div style="border-width: 0px 0px 0px 5px;  border-color: #025c9b;  border-style: solid;  padding: 10px 10px;   margin:0px 0px 10px 0px;">
                        <h4>{{ s }}</h4>
                    </div>
                    <h5 class="text-center"><u>目標値を満たしたサンプル※冒頭100行のみ</u></h5>
                    <div class="table-responsive text-break">
                        <table class="table table-striped table-hover number_table">
                            <thead>
                                <tr>
                                    <th style="text-align: right; min-width: 50px;" scope="col">#</th>
                                    {%- for i in df_Simulate_columns %} 
                                    <th style="text-align: right; min-width: 130px;" scope="col">{{ i|e }}</th>
                                    {%- endfor %}
                                </tr>
                            </thead>
                            <tbody>
                                {%- for i in df_Simulate_values %}
                                <tr>
                                    <th style="text-align: right; min-width: 50px;">{{ loop.index0 }}</th>
                                    {% for j in i %}
                                    <td style="text-align: right; min-width: 130px;">{{ j|e }}</td>
                                    {% endfor %}
                                </tr>
                                {%- endfor %}
                            </tbody>
                        </table>
                    </div>
                </li>
                {% endif %}
                <!--Search_Cluster用テンプレート-->
                {% if 'Search_Cluster' in search_method %}
                <li class="list-item">
                    <div style="border-width: 0px 0px 0px 5px;  border-color: #025c9b;  border-style: solid;  padding: 10px 10px;   margin:0px 0px 10px 0px;">
                        <h4>{{ s }}</h4>
                    </div>
                    <div class="container">
                        <div class="row align-items-start">
                            <div class="col text-center">
                                <h5><u>クラスタリング可視化結果</u></h5>
                            </div>                   
                        </div>                        
                        <div class="row align-items-start">
                            <div class="col text-center">
                                <a href="{{ cluster_path }}" target="_blank" rel="noopener"><img src="{{ cluster_path }}" onerror="this.style.display='none'" width="500" height="500"></a>
                            </div>                      
                        </div>
                    </div>
                    <h5 class="text-center"><u>各クラスタの平均値</u></h5>
                    <div class="table-responsive text-break">
                        <table class="table table-striped table-hover bulk_table" style="text-align: right;">
                            <thead>
                                <tr>
                                    <th style="text-align: right; min-width: 50px;" scope="col">#</th>
                                    {%- for i in df_Clustering_mean_columns %} 
                                    <th style="text-align: right; min-width: 130px;" scope="col">{{ i|e }}</th>
                                    {%- endfor %}
                                </tr>
                            </thead>
                            <tbody>
                                {%- for i in df_Clustering_mean_values %}
                                <tr>
                                    <th style="text-align: right; min-width: 50px;">{{ loop.index0 }}</th>
                                    {% for j in i %}
                                    <td style="text-align: right; min-width: 130px;">{{ j|e }}</td>
                                    {% endfor %}
                                </tr>
                                {%- endfor %}
                            </tbody>
                        </table>
                    </div>
                    <h5 class="text-center"><u>目標値を満たしたサンプル※冒頭100行のみ</u></h5>
                    <div class="table-responsive text-break">
                        <table class="table table-striped table-hover number_table" style="text-align: right;">
                            <thead>
                                <tr>
                                    <th style="text-align: right; min-width: 50px;" scope="col">#</th>
                                    {%- for i in df_Clustering_columns %} 
                                    <th style="text-align: right; min-width: 130px;" scope="col">{{ i|e }}</th>
                                    {%- endfor %}
                                </tr>
                            </thead>
                            <tbody>
                                {%- for i in df_Clustering_values %}
                                <tr>
                                    <th style="text-align: right; min-width: 50px;">{{ loop.index0 }}</th>
                                    {% for j in i %}
                                    <td style="text-align: right; min-width: 130px;">{{ j|e }}</td>
                                    {% endfor %}
                                </tr>
                                {%- endfor %}
                            </tbody>
                        </table>
                    </div>
                </li>
                {% endif %}
                <!--Search_Pareto用テンプレート-->
                {% if 'Search_Pareto' in search_method %}
                    <li class="list-item">
                        <div style="border-width: 0px 0px 0px 5px;  border-color: #025c9b;  border-style: solid;  padding: 10px 10px;   margin:0px 0px 10px 0px;">
                            <h4>{{ s }}</h4>
                        </div>
                        {% if ( objectives | length ) > 2 %}
                        <h5 class="text-center"><u>パレート解可視化結果</u></h5>
                        <div class="container">
                            {% for cnt in range( pareto_path_list | length ) %}          
                            <div class="row align-items-start align-middle text-center">
                                {% if (cnt)%3 == 0 %}     
                                <div class="col align-middle text-center">
                                    <h6>#1</h6>
                                    <a href="{{ pareto_path_list[cnt] }}" target="_blank" rel="noopener"><img src="{{ pareto_path_list[cnt] }}" onerror="this.style.display='none'" width="400" height="400"></a>
                                </div>
                                <div class="col align-middle text-center">
                                    <h6>#2</h6>
                                    <a href="{{ pareto_path_list[cnt+1] }}" target="_blank" rel="noopener"><img src="{{ pareto_path_list[cnt+1] }}" onerror="this.style.display='none'" width="400" height="400"></a>
                                </div>
                                <div class="col align-middle text-center">
                                    <h6>#3</h6>
                                    <a href="{{ pareto_path_list[cnt+2] }}" target="_blank" rel="noopener"><img src="{{ pareto_path_list[cnt+2] }}" onerror="this.style.display='none'" width="400" height="400"></a>
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <h5 class="text-center"><u>パレート解可視化結果</u></h5>
                        <div class="container">
                            <div class="row align-items-start align-middle text-center">
                                <div class="col align-middle text-center">
                                    <a href="{{ pareto_path_list[0] }}" target="_blank" rel="noopener"><img src="{{ pareto_path_list[0] }}" onerror="this.style.display='none'" width="600" height="280"></a>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        <h5 class="text-center"><u>目標値を満たしたサンプル※冒頭100行のみ</u></h5>
                        <div class="table-responsive text-break">
                            <table class="table table-striped table-hover number_table" style="text-align: right;">
                                <thead>
                                    <tr>
                                        <th style="text-align: right; min-width: 50px;" scope="col">#</th>
                                        {%- for i in df_pareto_columns %} 
                                        <th style="text-align: right; min-width: 130px;" scope="col">{{ i|e }}</th>
                                        {%- endfor %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {%- for i in df_pareto_values %}
                                    <tr>
                                        <th style="text-align: right; min-width: 50px;">{{ loop.index0 }}</th>
                                        {% for j in i %}
                                        <td style="text-align: right; min-width: 130px;">{{ j|e }}</td>
                                        {% endfor %}
                                    </tr>
                                    {%- endfor %}
                                </tbody>
                            </table>
                        </div>
                    </li>
                {% endif %}
            </li>
        </ul>
    </div>
</div> 
</div>
<!-- フッター -->
<div id=footer></div>

</body>
</html>
